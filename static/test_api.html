<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Connection</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: #fff;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-box {
            background: #222;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        .success { color: #0f0; }
        .error { color: #f00; }
        .info { color: #ff0; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #111;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API</h1>
    
    <div class="test-box">
        <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h2>
        <p>User Agent: <span id="userAgent"></span></p>
        <p>URL: <span id="currentUrl"></span></p>
    </div>

    <div class="test-box">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API</h2>
        <button onclick="testAPI()">–¢–µ—Å—Ç /api/watching</button>
        <div id="apiResult"></div>
    </div>

    <div class="test-box">
        <h2>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ TMDB API</h2>
        <button onclick="testTMDB()">–¢–µ—Å—Ç TMDB</button>
        <div id="tmdbResult"></div>
    </div>

    <div class="test-box">
        <h2>3. –ö–æ–Ω—Å–æ–ª—å –ª–æ–≥–æ–≤</h2>
        <pre id="console"></pre>
    </div>

    <script>
        var MY_API_URL = 'http://filme.64.188.67.85.sslip.io:8080';
        var TMDB_API_KEY = '4ef0d7355d9ffb5151e987764708ce96';
        var consoleLog = document.getElementById('console');

        function log(msg, type) {
            type = type || 'info';
            var time = new Date().toLocaleTimeString();
            var color = type === 'error' ? 'error' : (type === 'success' ? 'success' : 'info');
            consoleLog.innerHTML += '<span class="' + color + '">[' + time + '] ' + msg + '</span>\n';
            consoleLog.scrollTop = consoleLog.scrollHeight;
            console.log(msg);
        }

        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
        document.getElementById('userAgent').textContent = navigator.userAgent;
        document.getElementById('currentUrl').textContent = window.location.href;
        log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');

        function testAPI() {
            log('–ó–∞–ø—Ä–æ—Å –∫: ' + MY_API_URL + '/api/watching');
            var resultDiv = document.getElementById('apiResult');
            resultDiv.innerHTML = '<p class="info">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</p>';

            var xhr = new XMLHttpRequest();
            xhr.timeout = 10000;
            
            xhr.onload = function() {
                if (xhr.status === 200) {
                    try {
                        var data = JSON.parse(xhr.responseText);
                        log('‚úÖ API –æ—Ç–≤–µ—Ç–∏–ª —É—Å–ø–µ—à–Ω–æ: ' + data.length + ' —ç–ª–µ–º–µ–Ω—Ç–æ–≤', 'success');
                        resultDiv.innerHTML = '<p class="success">‚úÖ –£—Å–ø–µ—Ö! –ü–æ–ª—É—á–µ–Ω–æ ' + data.length + ' —ç–ª–µ–º–µ–Ω—Ç–æ–≤</p><pre>' + JSON.stringify(data.slice(0, 2), null, 2) + '</pre>';
                    } catch (e) {
                        log('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: ' + e.message, 'error');
                        resultDiv.innerHTML = '<p class="error">‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞: ' + e.message + '</p>';
                    }
                } else {
                    log('‚ùå HTTP –æ—à–∏–±–∫–∞: ' + xhr.status, 'error');
                    resultDiv.innerHTML = '<p class="error">‚ùå HTTP ' + xhr.status + '</p>';
                }
            };

            xhr.onerror = function() {
                log('‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ (CORS/Network)', 'error');
                resultDiv.innerHTML = '<p class="error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –í–æ–∑–º–æ–∂–Ω–æ CORS –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</p>';
            };

            xhr.ontimeout = function() {
                log('‚ùå Timeout', 'error');
                resultDiv.innerHTML = '<p class="error">‚ùå –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è</p>';
            };

            xhr.open('GET', MY_API_URL + '/api/watching', true);
            xhr.send();
        }

        function testTMDB() {
            log('–ó–∞–ø—Ä–æ—Å –∫ TMDB API');
            var resultDiv = document.getElementById('tmdbResult');
            resultDiv.innerHTML = '<p class="info">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</p>';

            var url = 'https://api.themoviedb.org/3/search/tv?api_key=' + TMDB_API_KEY + '&language=ru-RU&query=Breaking Bad';

            var xhr = new XMLHttpRequest();
            xhr.timeout = 10000;
            
            xhr.onload = function() {
                if (xhr.status === 200) {
                    try {
                        var data = JSON.parse(xhr.responseText);
                        log('‚úÖ TMDB –æ—Ç–≤–µ—Ç–∏–ª: ' + data.results.length + ' —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤', 'success');
                        resultDiv.innerHTML = '<p class="success">‚úÖ TMDB —Ä–∞–±–æ—Ç–∞–µ—Ç! –ù–∞–π–¥–µ–Ω–æ ' + data.results.length + ' —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>';
                    } catch (e) {
                        log('‚ùå –û—à–∏–±–∫–∞ TMDB: ' + e.message, 'error');
                        resultDiv.innerHTML = '<p class="error">‚ùå –û—à–∏–±–∫–∞: ' + e.message + '</p>';
                    }
                } else {
                    log('‚ùå TMDB HTTP –æ—à–∏–±–∫–∞: ' + xhr.status, 'error');
                    resultDiv.innerHTML = '<p class="error">‚ùå HTTP ' + xhr.status + '</p>';
                }
            };

            xhr.onerror = function() {
                log('‚ùå TMDB —Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞', 'error');
                resultDiv.innerHTML = '<p class="error">‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ TMDB</p>';
            };

            xhr.open('GET', url, true);
            xhr.send();
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            setTimeout(function() {
                log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç API...');
                testAPI();
            }, 1000);
        });
    </script>
</body>
</html>
